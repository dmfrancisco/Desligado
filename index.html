<!DOCTYPE HTML>
<html>
<head>
  <!-- Hello! -->
  <meta charset="utf-8" />
  <meta name="author" content="David Francisco">
  <meta name="reply-to" content="hello/at/dmfranc/dot/com">

  <title>Desligado</title>

  <link rel="stylesheet" href="style.css">
</head>
<body>
<!-- Ribbon -->
<a href="http://github.com/dmfrancisco/desligado"><img style="position:absolute; top:0; right:0; border:0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"></a>

<h1>Desligado</h1>
<h2 class="subtitle">simple web application supporting<br/>disconnection and deferred updates</h2>

<div id="container"><p><a href="#"><em><strong>Desligado</strong></em></a> is a proof-of-concept application made by junior
developers.</p>

<p>It's a <strong>simple <a href="http://en.wikipedia.org/wiki/Create,_read,_update_and_delete">CRUD</a> web app that runs both online and offline</strong>.
Since it is meant to work when the client is disconnected from the web, and/or
when the server is unavailable, it is heavily javascript based. Despite having
a view for each one of the common actions (show, index, new and edit), it's a
<a href="http://en.wikipedia.org/wiki/Single-page_application"><strong>single-page application</strong></a>, since all necessary code (HTML,
Javascript, and CSS) is retrieved with a single page load. Further
communication is made using Ajax and <strong><a href="http://dev.w3.org/html5/websockets/">HTML5 Web Sockets</a> with
<a href="http://www.json.org/js.html">JSON</a></strong>.</p>

<p>The resources are cached thanks to a <a href="http://www.w3.org/TR/html5/offline.html"><strong>HTML5 Cache Manifest</strong></a> file
and the client keeps a synced local version of the data on a <a href="http://www.w3.org/TR/webdatabase/"><strong>HTML5 WebSQL
database</strong></a> (or, if not supported by his browser, on his <a href="http://dev.w3.org/html5/webstorage/"><strong>Local
Storage</strong></a>).</p>

<h2>Demo</h2>

<p>This video shows some of the features (check the <a href="#specification">specification</a> chapter) and bugs (check the <a href="#issues">issues</a> list).
Music by <a href="http://myspace.com/bfachada" target="_blank">B Fachada</a>.</p>

<iframe src="https://player.vimeo.com/video/24062607?title=0&amp;byline=0&amp;portrait=0&amp;color=ceb9d5" width="516" height="290" frameborder="0"></iframe>

<h2>Index</h2>

<ol>
<li><a href="#specification">Specification</a></li>
<li><a href="#dependencies">Dependencies</a></li>
<li><a href="#downloads">Downloads</a></li>
<li><a href="#supported-browsers">Supported Browsers and Caveats</a></li>
<li><a href="#the-application">The Application</a>
<ol><li><a href="#core-technologies">Core technologies</a></li>
<li><a href="#javascript-mvc-framework">Javascript MVC framework</a></li>
<li><a href="#data-synchronization">Data synchronization</a></li>
<li><a href="#server-pushing">Server Pushing</a></li>
<li><a href="#directory-structure">Directory structure</a></li></ol></li>
<li><a href="#initialization">Initialization</a></li>
<li><a href="#usage">Usage</a></li>
<li><a href="#issues">Issues</a></li>
<li><a href="#change-log">Change Log</a></li>
<li><a href="#contribute">Contribute</a></li>
<li><a href="#authors">Authors</a></li>
</ol>

<div id="specification"></div>

<h2>Specification</h2>

<p><em><strong>Desligado</strong></em> is a simple item management application.
Those are the functional requirements:</p>

<ul>
<li>Users must be able to create, edit, destroy and list items</li>
<li>The item list must be updated, every time the server's database changes (without requiring any clicks)</li>
<li>Users must be able to use the app offline (static contents should be presented, and dynamic contents must function) even after closing and reopening the browser</li>
</ul>

<hr>

<div id="dependencies"></div>

<h2>Dependencies</h2>

<ul>
<li>Built with Ruby 1.9.2 and Rails 3.0.5</li>
<li><a href="http://faye.jcoglan.com/">Faye</a> gem (tested with 0.5.5)</li>
<li><a href="http://documentcloud.github.com/jammit/">Jammit!</a> gem (tested with 0.6.0)</li>
<li><a href="http://jquery.com/">jQuery</a> (included; version 1.4.4)</li>
<li><a href="http://documentcloud.github.com/backbone/">backbone.js</a> (included; version 0.3.3)</li>
<li><a href="http://persistencejs.org/">persistence.js</a> (included; version 0.2.4)</li>
</ul>

<hr>

<div id="downloads"></div>

<h2>Downloads</h2>

<ul>
<li><a href="https://github.com/dmfrancisco/Desligado/zipball/v1.1.8-stable">Entire demo app</a> (<em>version 1.1.8 stable</em>)</li>
<li><a href="https://github.com/dmfrancisco/Desligado/blob/master/app/controllers/items_controller.rb">Rails Sync</a> for persistence.sync</li>
<li><a href="https://github.com/dmfrancisco/Desligado/blob/master/public/javascripts/app/sync.js">Backbone.sync adapter</a> for persistence.js</li>
</ul>

<hr>

<div id="supported-browsers"></div>

<h2>Supported Browsers and Caveats</h2>

<p>Should work with, at least:</p>

<ul>
<li>Chrome 11+</li>
<li>Mozilla Firefox 4+</li>
</ul>

<p>It doesn't seem to work on Safari 5 (not fully tested), and Firefox will use
local storage instead of WebSQL. Beware that, if the HTML layout file contains
the reference to the application manifest, server pushing will not work.
Comment out the reference <em>&lt;... manifest="application.manifest"&gt;</em> or just
remove the <em>public/application.manifest</em> file to try it. This is a known
issue.</p>

<hr>

<div id="the-application"></div>

<h2>The Application</h2>

<p>The goal for this project was to create a multi-client simple web application
with some basic functionalities (the creation, manipulation and deletion of
shared items) that worked both online and offline.</p>

<div id="core-technologies"></div>

<h3>Core technologies</h3>

<div class="dropcap t">T</div>

<p>o achieve the behaviour of keeping functionality in offline mode, we used
several techniques introduced in HTML5 — <a href="http://www.w3.org/TR/html5/offline.html">Cache Manifest</a>,
<a href="http://www.w3.org/TR/webdatabase/">WebSQL</a>, <a href="http://dev.w3.org/html5/webstorage/">Local Storage</a> and <a href="http://dev.w3.org/html5/websockets/">Web
Sockets</a>.</p>

<p>Starting with the cache manifest, since we used Ruby on Rails for our
back-end, to dynamically generate this manifest file we used the
<a href="https://github.com/wycats/rack-offline">rack-offline</a> gem, as suggested by Ryan Bates on his interesting
<a href="http://railscasts.com/episodes/247">railscast</a>. Every time the user opens the website, all files
required by the application are downloaded and saved for offline browsing.
This solves the problem of accessing the static content in offline mode.</p>

<p>Another important aspect is that only one HTML page is fetched from the
server. This page contains the necessary components to generate four views —
index, show, edit and new. We used <a href="http://documentcloud.github.com/backbone/">backbone.js</a> and
<a href="http://documentcloud.github.com/underscore/">underscore</a> templates to build them. Backbone.js let us
implement a well-structured client-side application, but is not so
<strike>rigid</strike> opinionated as Rails. To organize our client-side code,
we followed the approach designed by <a href="http://www.jamesyu.org/">James Yu</a> on his
<a href="http://t.co/hkBlDvo">article</a> about backbone.js.</p>

<div id="javascript-mvc-framework"></div>

<h3>Javascript MVC framework</h3>

<div class="dropcap b">B</div>

<p>ackbone is composed by several modules. It contains one module called
Backbone.sync which lets us persist data through RESTful JSON requests to the
server. Since we want it to work offline too, we need it to persist the data
locally, using the HTML5 WebSQL technology (if supported by the browser) or the Local Storage. This would be synced to the server, if possible, when both
client and server are online. This is tougher than it may look, since we are
talking about a multi-client app, with desynchronized clocks, etc..</p>

<div id="data-synchronization"></div>

<h3>Data synchronization</h3>

<div class="dropcap i">I</div>

<p>n what concerns persistence, we used persistence.js, and specifically the
<a href="http://persistencejs.org/plugin/sync">persistence.sync.js</a> plugin, to keep the databases synced together.
We created an adapter, a new Backbone.sync module, which maps the CRUD actions
with the persistence.sync.js library's API.</p>

<p>Another problem is that persistence.sync was primarly made to communicate
with node.js servers. Since we are using Rails, we coded the necessary
mechanisms to make it work with RoR.</p>

<div id="server-pushing"></div>

<h3>Server pushing</h3>

<div class="dropcap a">A</div>

<p>t last, we wanted the server to broadcast to all connected clients when one of
them modifies the server's database. We integrated <a href="http://persistencejs.org/plugin/sync">Faye</a> for the
server-&gt;client communication, which uses WebSockets, XMLHttpRequest (if
WebSockets not supported) or JSON-P (if no other alternative is supported). We
are still having some crazy issues regarding having both Faye and the
application.manifest) which are listed on the bottom of this document.</p>

<div id="directory-structure"></div>

<h3>Directory structure</h3>

<pre><code>app/
    controllers/
        application_controller.rb
        home_controller.rb
        items_controller.rb
    models/
        item.rb
    views/
        home/
            index.html.erb
        items/
            edit.jst
            index.jst
            show.jst
public/
    javascripts/
        app/
            collections/
                items.js
            controllers/
                items.js
            models/
                item.js
            views/
                edit.js
                index.js
                notice.js
                show.js
            application.js
            server.push.js
            sync.js
</code></pre>

<hr>

<div id="initialization"></div>

<h2>Initialization</h2>

<p>To initialize the application, run:</p>

<pre>
<code>mv config/database.yml.sample config/database.yml</code>
<code>mv public/application.manifest.sample public/application.manifest</code>
<code>bundle install</code>
<code>rake db:migrate</code>
</pre>

<hr>

<div id="usage"></div>

<h2>Usage</h2>

<p>Run Faye:</p>

<pre><code>rackup script/faye.ru -s thin -E production</code></pre>

<p>Run the Rails sever:</p>

<pre><code>rails server</code></pre>

<hr>

<div id="issues"></div>

<h2>Issues</h2>

<p>A list of the current issues will be added soon.</p>

<hr>

<div id="change-log"></div>

<h2>Change log</h2>

<p>For now, you may check our github page to keep track of all the undergoing
changes.</p>

<hr>

<div id="contribute"></div>

<h2>Contribute</h2>

<p>Feel free to use the code for your own projects. Improvements are very
welcome (keep in mind that we are junior developers, with no background on
Javascript, asynchronous programming and all the like). Pull requests to our
<a href="http://github.com/dmfrancisco/Desligado">git repository</a> would be greatly appreciated!</p>

<hr>

<div id="authors"></div>

<h2>Authors</h2>

<ul>
<li>David Francisco { <a href="mailto:hello@dmfranc.com">hello@dmfranc.com</a>; <a href="http://twitter.com/dmfrancisco">@dmfrancisco</a> }</li>
<li>José Dias { <a href="mailto:jacdias@student.dei.uc.pt">jacdias@student.dei.uc.pt</a> }</li>
</ul>

<hr>

<p><em>This template was inspired by the work of <a href="http://documentcloud.github.com/docsplit/">DocumentCloud</a>. Background
image is from <a href="http://subtlepatterns.com/">SubtlePatterns</a>. Drop Caps from <a href="http://www.reusableart.com/">ReusableArt</a>.</em></p></div>
</body>
</html>
